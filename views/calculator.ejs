<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= title %>
    </title>
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/main.css">
    <style>
        .calc-container {
            max-width: 600px;
            margin: 40px auto;
        }

        .exam-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 20px;
            color: var(--color-primary-dark);
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 25px;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--color-secondary);
        }

        .input-field {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.8);
            border-radius: var(--radius-md);
            font-size: 1.1rem;
            font-family: var(--font-heading);
            transition: all 0.3s;
            text-align: center;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--color-primary);
            background: white;
            box-shadow: 0 0 15px rgba(224, 122, 95, 0.2);
        }

        .select-field {
            text-align-last: center;
            cursor: pointer;
        }

        .marking-info {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            background: rgba(61, 90, 128, 0.05);
            padding: 15px;
            border-radius: var(--radius-md);
            font-size: 0.9rem;
        }

        .info-item span {
            display: block;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--color-primary);
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.5);
            padding: 5px;
            border-radius: 50px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            border-radius: 50px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: var(--color-secondary);
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: white;
            color: var(--color-primary);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .row {
            display: flex;
            gap: 15px;
        }

        .col {
            flex: 1;
        }

        .details-section {
            background: rgba(255, 255, 255, 0.4);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .section-label {
            font-size: 0.9rem;
            color: var(--color-text-muted);
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <div class="main-wrapper">
        <%- include('partials/header') %>

            <div class="container calc-container">
                <div class="glass-card">
                    <div style="text-align: center;">
                        <span class="exam-badge">
                            <%= exam.category %>
                        </span>
                        <h1 style="font-size: 2rem; margin-bottom: 10px;">
                            <%= exam.name %>
                        </h1>
                    </div>

                    <!-- Tabs -->
                    <div class="tabs">
                        <div class="tab-btn active" onclick="switchTab('url')">Answer Key URL</div>
                        <div class="tab-btn" onclick="switchTab('manual')">Manual Entry</div>
                    </div>

                    <!-- URL Parser Form -->
                    <div id="url-tab" class="tab-content active">
                        <p style="text-align: center; color: var(--color-text-muted); margin-bottom: 20px;">Paste your
                            Digialm URL directly.</p>

                        <form action="/calculator/parse" method="POST">
                            <input type="hidden" name="exam_id" value="<%= exam.id %>">

                            <div class="input-group">
                                <input type="url" name="url" class="input-field" placeholder="https://..." required
                                    style="text-align: left;">
                            </div>

                            <!-- User Details -->
                            <div class="details-section">
                                <div class="section-label">Your Details</div>
                                <div class="row">
                                    <div class="col input-group">
                                        <label>Category *</label>
                                        <select name="category" class="input-field select-field" required>
                                            <option value="">Select</option>
                                            <option value="GENERAL">GENERAL</option>
                                            <option value="EWS">EWS</option>
                                            <option value="OBC(NCL)">OBC (NCL)</option>
                                            <option value="SC">SC</option>
                                            <option value="ST">ST</option>
                                        </select>
                                    </div>
                                    <div class="col input-group">
                                        <label>Gender *</label>
                                        <select name="gender" class="input-field select-field" required>
                                            <option value="">Select</option>
                                            <option value="MALE">MALE</option>
                                            <option value="FEMALE">FEMALE</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col input-group">
                                        <label>Medium *</label>
                                        <select name="medium" class="input-field select-field" required>
                                            <option value="">Select</option>
                                            <option value="HINDI">HINDI</option>
                                            <option value="ENGLISH">ENGLISH</option>
                                        </select>
                                    </div>
                                    <div class="col input-group">
                                        <label>Horizontal Category</label>
                                        <select name="horizontal_category" class="input-field select-field">
                                            <option value="None">None</option>
                                            <option value="ESM">Ex-Serviceman (ESM)</option>
                                            <option value="OH">OH (Orthopedic)</option>
                                            <option value="VH">VH (Visual)</option>
                                            <option value="HH">HH (Hearing)</option>
                                            <option value="Other PwD">Other PwD</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col input-group">
                                        <label>State *</label>
                                        <select name="state" class="input-field select-field" required>
                                            <option value="">Select State</option>
                                            <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands
                                            </option>
                                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                            <option value="Assam">Assam</option>
                                            <option value="Bihar">Bihar</option>
                                            <option value="Chandigarh">Chandigarh</option>
                                            <option value="Chhattisgarh">Chhattisgarh</option>
                                            <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar
                                                Haveli and Daman and Diu</option>
                                            <option value="Delhi">Delhi</option>
                                            <option value="Goa">Goa</option>
                                            <option value="Gujarat">Gujarat</option>
                                            <option value="Haryana">Haryana</option>
                                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                            <option value="Jharkhand">Jharkhand</option>
                                            <option value="Karnataka">Karnataka</option>
                                            <option value="Kerala">Kerala</option>
                                            <option value="Ladakh">Ladakh</option>
                                            <option value="Lakshadweep">Lakshadweep</option>
                                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                                            <option value="Maharashtra">Maharashtra</option>
                                            <option value="Manipur">Manipur</option>
                                            <option value="Meghalaya">Meghalaya</option>
                                            <option value="Mizoram">Mizoram</option>
                                            <option value="Nagaland">Nagaland</option>
                                            <option value="Odisha">Odisha</option>
                                            <option value="Puducherry">Puducherry</option>
                                            <option value="Punjab">Punjab</option>
                                            <option value="Rajasthan">Rajasthan</option>
                                            <option value="Sikkim">Sikkim</option>
                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                            <option value="Telangana">Telangana</option>
                                            <option value="Tripura">Tripura</option>
                                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                                            <option value="Uttarakhand">Uttarakhand</option>
                                            <option value="West Bengal">West Bengal</option>
                                        </select>
                                    </div>
                                    <div class="col input-group" id="url-zone-group" style="display: none;">
                                        <label>Applied Zone (RRB) *</label>
                                        <select name="zone" id="url-zone" class="input-field select-field">
                                            <option value="">Select RRB Zone</option>
                                            <option value="Ahmedabad">RRB Ahmedabad</option>
                                            <option value="Ajmer">RRB Ajmer</option>
                                            <option value="Allahabad">RRB Allahabad (Prayagraj)</option>
                                            <option value="Bangalore">RRB Bangalore</option>
                                            <option value="Bhopal">RRB Bhopal</option>
                                            <option value="Bhubaneswar">RRB Bhubaneswar</option>
                                            <option value="Bilaspur">RRB Bilaspur</option>
                                            <option value="Chandigarh">RRB Chandigarh</option>
                                            <option value="Chennai">RRB Chennai</option>
                                            <option value="Gorakhpur">RRB Gorakhpur</option>
                                            <option value="Guwahati">RRB Guwahati</option>
                                            <option value="Jammu">RRB Jammu-Srinagar</option>
                                            <option value="Kolkata">RRB Kolkata</option>
                                            <option value="Malda">RRB Malda</option>
                                            <option value="Mumbai">RRB Mumbai</option>
                                            <option value="Muzaffarpur">RRB Muzaffarpur</option>
                                            <option value="Patna">RRB Patna</option>
                                            <option value="Ranchi">RRB Ranchi</option>
                                            <option value="Secunderabad">RRB Secunderabad</option>
                                            <option value="Siliguri">RRB Siliguri</option>
                                            <option value="Thiruvananthapuram">RRB Thiruvananthapuram</option>
                                        </select>
                                    </div>
                                    <div class="col" id="url-empty-filler"></div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary" style="width: 100%;">Calculate from
                                URL</button>
                        </form>
                    </div>

                    <!-- Manual Form -->
                    <div id="manual-tab" class="tab-content">
                        <p style="text-align: center; color: var(--color-text-muted); margin-bottom: 20px;">Enter your
                            attempts manually.</p>
                        <form action="/calculator/calculate" method="POST">
                            <input type="hidden" name="exam_id" value="<%= exam.id %>">

                            <div class="input-group">
                                <label for="correct">Correct Questions (Sahi)</label>
                                <input type="number" id="correct" name="correct" class="input-field" placeholder="0"
                                    min="0" max="<%= exam.total_questions %>">
                            </div>

                            <div class="input-group">
                                <label for="wrong">Wrong Questions (Galat)</label>
                                <input type="number" id="wrong" name="wrong" class="input-field" placeholder="0" min="0"
                                    max="<%= exam.total_questions %>">
                            </div>

                            <div
                                style="text-align: center; margin-bottom: 20px; font-size: 0.9rem; color: var(--color-text-muted);">
                                Unattempted: <span id="unattemptedVal">
                                    <%= exam.total_questions %>
                                </span>
                            </div>
                            <input type="hidden" id="unattempted" name="unattempted"
                                value="<%= exam.total_questions %>">

                            <!-- User Details -->
                            <div class="details-section">
                                <div class="section-label">Your Details</div>
                                <div class="row">
                                    <div class="col input-group">
                                        <label>Category *</label>
                                        <select name="category" class="input-field select-field" required>
                                            <option value="">Select</option>
                                            <option value="GENERAL">GENERAL</option>
                                            <option value="EWS">EWS</option>
                                            <option value="OBC(NCL)">OBC (NCL)</option>
                                            <option value="SC">SC</option>
                                            <option value="ST">ST</option>
                                        </select>
                                    </div>
                                    <div class="col input-group">
                                        <label>Gender *</label>
                                        <select name="gender" class="input-field select-field" required>
                                            <option value="">Select</option>
                                            <option value="MALE">MALE</option>
                                            <option value="FEMALE">FEMALE</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col input-group">
                                        <label>Medium *</label>
                                        <select name="medium" class="input-field select-field" required>
                                            <option value="">Select</option>
                                            <option value="HINDI">HINDI</option>
                                            <option value="ENGLISH">ENGLISH</option>
                                        </select>
                                    </div>
                                    <div class="col input-group">
                                        <label>Horizontal Category</label>
                                        <select name="horizontal_category" class="input-field select-field">
                                            <option value="None">None</option>
                                            <option value="ESM">Ex-Serviceman (ESM)</option>
                                            <option value="OH">OH (Orthopedic)</option>
                                            <option value="VH">VH (Visual)</option>
                                            <option value="HH">HH (Hearing)</option>
                                            <option value="Other PwD">Other PwD</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col input-group">
                                        <label>State *</label>
                                        <select name="state" class="input-field select-field" required>
                                            <option value="">Select State</option>
                                            <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands
                                            </option>
                                            <option value="Andhra Pradesh">Andhra Pradesh</option>
                                            <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                                            <option value="Assam">Assam</option>
                                            <option value="Bihar">Bihar</option>
                                            <option value="Chandigarh">Chandigarh</option>
                                            <option value="Chhattisgarh">Chhattisgarh</option>
                                            <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar
                                                Haveli and Daman and Diu</option>
                                            <option value="Delhi">Delhi</option>
                                            <option value="Goa">Goa</option>
                                            <option value="Gujarat">Gujarat</option>
                                            <option value="Haryana">Haryana</option>
                                            <option value="Himachal Pradesh">Himachal Pradesh</option>
                                            <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                                            <option value="Jharkhand">Jharkhand</option>
                                            <option value="Karnataka">Karnataka</option>
                                            <option value="Kerala">Kerala</option>
                                            <option value="Ladakh">Ladakh</option>
                                            <option value="Lakshadweep">Lakshadweep</option>
                                            <option value="Madhya Pradesh">Madhya Pradesh</option>
                                            <option value="Maharashtra">Maharashtra</option>
                                            <option value="Manipur">Manipur</option>
                                            <option value="Meghalaya">Meghalaya</option>
                                            <option value="Mizoram">Mizoram</option>
                                            <option value="Nagaland">Nagaland</option>
                                            <option value="Odisha">Odisha</option>
                                            <option value="Puducherry">Puducherry</option>
                                            <option value="Punjab">Punjab</option>
                                            <option value="Rajasthan">Rajasthan</option>
                                            <option value="Sikkim">Sikkim</option>
                                            <option value="Tamil Nadu">Tamil Nadu</option>
                                            <option value="Telangana">Telangana</option>
                                            <option value="Tripura">Tripura</option>
                                            <option value="Uttar Pradesh">Uttar Pradesh</option>
                                            <option value="Uttarakhand">Uttarakhand</option>
                                            <option value="West Bengal">West Bengal</option>
                                        </select>
                                    </div>
                                    <div class="col input-group" id="manual-zone-group" style="display: none;">
                                        <label>Applied Zone (RRB) *</label>
                                        <select name="zone" id="manual-zone" class="input-field select-field">
                                            <option value="">Select RRB Zone</option>
                                            <option value="Ahmedabad">RRB Ahmedabad</option>
                                            <option value="Ajmer">RRB Ajmer</option>
                                            <option value="Allahabad">RRB Allahabad (Prayagraj)</option>
                                            <option value="Bangalore">RRB Bangalore</option>
                                            <option value="Bhopal">RRB Bhopal</option>
                                            <option value="Bhubaneswar">RRB Bhubaneswar</option>
                                            <option value="Bilaspur">RRB Bilaspur</option>
                                            <option value="Chandigarh">RRB Chandigarh</option>
                                            <option value="Chennai">RRB Chennai</option>
                                            <option value="Gorakhpur">RRB Gorakhpur</option>
                                            <option value="Guwahati">RRB Guwahati</option>
                                            <option value="Jammu">RRB Jammu-Srinagar</option>
                                            <option value="Kolkata">RRB Kolkata</option>
                                            <option value="Malda">RRB Malda</option>
                                            <option value="Mumbai">RRB Mumbai</option>
                                            <option value="Muzaffarpur">RRB Muzaffarpur</option>
                                            <option value="Patna">RRB Patna</option>
                                            <option value="Ranchi">RRB Ranchi</option>
                                            <option value="Secunderabad">RRB Secunderabad</option>
                                            <option value="Siliguri">RRB Siliguri</option>
                                            <option value="Thiruvananthapuram">RRB Thiruvananthapuram</option>
                                        </select>
                                    </div>
                                    <div class="col" id="manual-empty-filler"></div>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary" style="width: 100%;">Calculate Result</button>
                        </form>
                    </div>

                    <div class="marking-info">
                        <div class="info-item">Correct <span>+<%= exam.marks_per_question %></span></div>
                        <div class="info-item">Negative <span style="color: var(--color-error);">-<%=
                                    exam.negative_marks %></span></div>
                        <div class="info-item">Total <span>
                                <%= exam.total_questions * exam.marks_per_question %>
                            </span></div>
                    </div>
                </div>
            </div>

            <%- include('partials/footer') %>
    </div>

    <script>
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            if (tab === 'url') {
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('url-tab').classList.add('active');
            } else {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('manual-tab').classList.add('active');
            }
        }

        const totalQs = <%= exam.total_questions %>;
        const correctInput = document.getElementById('correct');
        const wrongInput = document.getElementById('wrong');
        const unattemptedDisplay = document.getElementById('unattemptedVal');
        const unattemptedInput = document.getElementById('unattempted');

        function updateCounts() {
            const c = parseInt(correctInput.value) || 0;
            const w = parseInt(wrongInput.value) || 0;
            if (c + w > totalQs) { wrongInput.value = 0; return; }
            const u = totalQs - (c + w);
            unattemptedDisplay.innerText = u;
            unattemptedInput.value = u;
        }

        if (correctInput && wrongInput) {
            correctInput.addEventListener('input', updateCounts);
            wrongInput.addEventListener('input', updateCounts);
        }

        // RRB Zone Visibility Logic
        const examCategory = "<%= exam.category %>";
        if (examCategory === "Railway") {
            document.getElementById('url-zone-group').style.display = 'block';
            document.getElementById('manual-zone-group').style.display = 'block';
            document.getElementById('url-zone').required = true;
            document.getElementById('manual-zone').required = true;
            document.getElementById('url-empty-filler').style.display = 'none';
            document.getElementById('manual-empty-filler').style.display = 'none';
        }
    </script>
</body>

</html>